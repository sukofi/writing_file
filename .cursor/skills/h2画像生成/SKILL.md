---
name: h2画像生成
description: 買取系SEO記事の初稿（初稿：[KW名].html）が完了した後、h2直下の画像を生成・圧縮・保存・HTML挿入する。初稿完了時に発動。Use when 初稿完了, 初稿ができた, h2画像生成, h2用画像を作成, or after drafting 初稿.html.
---

# h2画像生成：初稿完了時のフロー

初稿HTMLが完成したら、各h2直下に配置する画像を生成し、圧縮して保存・HTMLへ挿入する。

## フロー（生成→保存）

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 1. 準備                                                                  │
│    ├─ image_prompts.yaml（h2ごとのプロンプト）を確認・作成                 │
│    ├─ .env（GOOGLE_CLOUD_PROJECT または GOOGLE_API_KEY）を確認            │
│    └─ 初稿HTMLに <img src="" alt="..." /> のプレースホルダがあることを確認  │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 2. 画像生成                                                              │
│    ├─ 大吉訴求h2（use_fixed: true）→ 00.共通素材/daikichi_kyusyu.png をコピー │
│    └─ その他h2 → Vertex AI Imagen 3 でプロンプトに基づき生成               │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 3. 圧縮                                                                  │
│    └─ JPEG品質85%、最大幅1920pxで保存                                     │
└─────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────┐
│ 4. 保存・挿入                                                             │
│    ├─ images/img_01.jpg 〜 img_XX.jpg をKWフォルダ内 images/ に保存       │
│    └─ 初稿HTMLの src="" を images/img_XX.jpg に更新                       │
└─────────────────────────────────────────────────────────────────────────┘
```

## 実行手順

1. **scriptsフォルダへ移動**
   ```
   cd scripts/h2画像生成
   ```

2. **仮想環境のセットアップ**（初回のみ）
   ```
   python -m venv .venv
   source .venv/bin/activate  # Windows: .venv\Scripts\activate
   pip install -r requirements.txt
   ```

3. **スクリプト実行**（KWフォルダパスを引数で指定）
   ```
   .venv/bin/python generate_h2_images.py "01.対策KW/一万円札 ホログラムなし"
   ```

4. **出力確認**  
   `images/` に img_01.jpg 〜 が保存され、初稿HTMLの `src=""` が自動更新されていることを確認

## ファイル配置

| 場所 | ファイル | 役割 |
|------|----------|------|
| `scripts/h2画像生成/` | `generate_h2_images.py` | 生成・圧縮・HTML更新スクリプト |
| `scripts/h2画像生成/` | `requirements.txt` | 依存パッケージ |
| `scripts/h2画像生成/` | `.env` | GOOGLE_CLOUD_PROJECT または GOOGLE_API_KEY |
| KWフォルダ内 | `image_prompts.yaml` | h2ごとの画像プロンプト |
| KWフォルダ内 | `初稿：[KW名].html` | 挿入先HTML |
| プロジェクトルート | `00.共通素材/daikichi_kyusyu.png` | 大吉訴求h2用固定画像 |

## 大吉訴求h2の固定画像

大吉訴求ブロック（例：紙幣の査定・買取は『買取大吉』にお任せ）のh2画像は**毎回固定画像を使用**する。

- **画像パス**: `00.共通素材/daikichi_kyusyu.png`
- **image_prompts.yaml**: 該当h2に `use_fixed: true` を付与
- スクリプトは `use_fixed: true` のときAPI生成をスキップし、固定画像をコピーする

## プロンプトのルール（image_prompts.yaml）

- **文脈解析**: 主役・雰囲気（清潔感・高級感・安心感）を判断
- **商標配慮**: 実物紙幣の精密再現は避け、質感・シルエットで表現
- **スタイル**: フォトリアル、スタジオライティング、16:9
- **一万円札の場合**: 「Japanese 10000 yen banknote」「ten thousand yen」「NOT 1000 yen, NOT 5000 yen」を明記（1000円札にならないよう）
- **Q&A見出し**: Q&Aの画像は必ずQ&Aを連想させるものにする（FAQアイコン、質問・回答のやり取り、相談シーンなど）。**対策KWは含めない**（紙幣・商品名・品目などは指定しない）。

## 初回セットアップ（新規記事）

1. 既存KWフォルダから `image_prompts.yaml` をコピー
2. `image_prompts.yaml` の h2・alt を構成に合わせて修正
3. 大吉訴求h2には `use_fixed: true` を付与
4. 初稿HTMLの各h2直下に `<p><img class="aligncenter size-full" src="" alt="〇〇" /></p>` を配置
5. `.env` に Vertex AI または Gemini API の認証情報を設定
